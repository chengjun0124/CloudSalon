(function(){app.factory("locationEx",["$location",function(n){return n.queryString=function(t){var i=n.absUrl().match(new RegExp("[?&]"+t+"=([^#&]*)"));return i==null?null:i[1]},n}]);app.factory("routeService",["$state",function(n){return{goParams:function(t,i){$("html, body").scrollTop(0);n.go(t,i,{reload:!0})}}}]);app.factory("encodeService",[function(){function t(n){var i,r,t;for(n=n.replace(/\r\n/g,"\n"),i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i}function i(n){for(var r="",t=0,i=c1=c2=0;t<n.length;)i=n.charCodeAt(t),i<128?(r+=String.fromCharCode(i),t++):i>191&&i<224?(c2=n.charCodeAt(t+1),r+=String.fromCharCode((i&31)<<6|c2&63),t+=2):(c2=n.charCodeAt(t+1),c3=n.charCodeAt(t+2),r+=String.fromCharCode((i&15)<<12|(c2&63)<<6|c3&63),t+=3);return r}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{base64Encode:function(i){var o="",s,r,u,c,l,h,f,e=0;for(i=t(i);e<i.length;)s=i.charCodeAt(e++),r=i.charCodeAt(e++),u=i.charCodeAt(e++),c=s>>2,l=(s&3)<<4|r>>4,h=(r&15)<<2|u>>6,f=u&63,isNaN(r)?h=f=64:isNaN(u)&&(f=64),o=o+n.charAt(c)+n.charAt(l)+n.charAt(h)+n.charAt(f);return o},base64Decode:function(t){var r="",s,h,c,l,e,f,o,u=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<t.length;)l=n.indexOf(t.charAt(u++)),e=n.indexOf(t.charAt(u++)),f=n.indexOf(t.charAt(u++)),o=n.indexOf(t.charAt(u++)),s=l<<2|e>>4,h=(e&15)<<4|f>>2,c=(f&3)<<6|o,r=r+String.fromCharCode(s),f!=64&&(r=r+String.fromCharCode(h)),o!=64&&(r=r+String.fromCharCode(c));return i(r)}}}]);app.factory("dialogService",["ngDialog","$rootScope","routeService",function(n,t,i){var r,u,f;return{showMention:function(u,f,e,o,s){r=n.open({template:t.dialogMentionTemplate,plain:!1,showClose:!1,closeByEscape:!1,overlay:!0,className:"ngdialog-theme-mention",closeByDocument:!1,controller:["$scope",function(n){n.close=function(){r.close();e&&i.goParams(e,o)};n.confirm=function(){r.close();s();e&&i.goParams(e,o)}}],data:{buttonCount:u,content:f}})},showUploadImage:function(i,r,f,e){u=n.open({template:t.dialogUploadImageTemplate,plain:!1,showClose:!1,closeByEscape:!1,overlay:!1,className:"ngdialog-theme-upload-image",closeByDocument:!1,data:{base64Image:i},controller:["$scope",function(n){function nt(n){l.css({width:n.width+"px",left:n.left+"px",height:n.height+"px",top:n.top+"px"})}function yt(){t=at<y/g?a(h,"height",!0,!1):a(s,"width",!0,!1)}function pt(n){n.left>b+c&&(n.left=b+c);n.top>k+c&&(n.top=k+c);p-n.left-n.width>p-s-c-b&&(n.left=p-n.width-(p-s-c-b));w-n.top-n.height>w-h-c-k&&(n.top=w-n.height-(w-h-c-k))}function a(n,i,r,u){var f,e,o,s,h;return i=="width"?(f=n,e=g*f/y):(e=n,f=y*e/g),r?(o=(p-f)/2,s=(w-e)/2):(o=t.left-(f-t.width)/2,s=t.top-(e-t.height)/2),h={width:f,height:e,left:o,top:s},u&&pt(h),h}var v={x:null,y:null},o={x:null,y:null,w:null,h:null},t={},d={},y,g,l,p=$(window).width(),w=$(window).height(),tt,it,rt,ut,ft,et,ot,st,s=r,h=f,at=s/h,ht=!1,ct=500,lt=600,vt;s<ct&&h<lt&&(vt=ct/lt,vt<s/h?(s=ct,h=f*(s/r)):(h=lt,s=r*(h/f)));var c=1e3,b=(p-s-c*2)/2,k=(w-h-c*2)/2;n.base64Image=i;n.divCutCSS={width:s+c*2+"px",height:h+c*2+"px","border-width":c+"px",left:b+"px",top:k+"px"};n.cancel=function(){u.close()};n.imgLoaded=function(){function n(n,i){l.css({"transition-property":"","transition-duration":""});i==undefined&&(v.x=n.x,v.y=n.y,o.x=0,o.y=0);i!=undefined&&(t.left+=o.x,t.top+=o.y,n.x<i.x?(tt=0,ft=n.x,it=1,et=i.x):(tt=1,ft=i.x,it=0,et=n.x),n.y<i.y?(rt=0,ot=n.y,ut=1,st=i.y):(rt=1,ot=i.y,ut=0,st=n.y),o.x=0,o.y=0,o.w=0,o.h=0)}function i(n,i){if(i==undefined&&(o.x=n.x-v.x,o.y=n.y-v.y,l.css({left:t.left+o.x+"px",top:t.top+o.y+"px"})),i!=undefined){var r=tt==0?n:i,u=it==0?n:i,f=rt==0?n:i,e=ut==0?n:i;o.w=ft-r.x;o.w+=u.x-et;d=a(t.width+o.w,"width",!1,!1);o.h=ot-f.y;o.h+=e.y-st;d=a(d.height+o.h,"height",!1,!1);nt(d)}}function r(n){n!=undefined&&(v.x=n.x,v.y=n.y,t=d,o.x=0,o.y=0,o.w=0,o.h=0);n==undefined&&(t.left+=o.x,t.top+=o.y,o.x=0,o.y=0,t.width<s||t.height<h?yt():pt(t),l.css({"transition-property":"left,top","transition-duration":"0.3s"}));nt(t)}l=$("#oimg");y=l.width();g=l.height();yt();nt(t);$(".ngdialog-content").bind("touchstart",function(t){t.touches.length==1&&n({x:t.touches[0].screenX,y:t.touches[0].screenY});t.touches.length==2&&n({x:t.touches[0].screenX,y:t.touches[0].screenY},{x:t.touches[1].screenX,y:t.touches[1].screenY})});$(".ngdialog-content").bind("touchmove",function(n){n.preventDefault();n.touches.length==1&&i({x:n.touches[0].screenX,y:n.touches[0].screenY});n.touches.length==2&&i({x:n.touches[0].screenX,y:n.touches[0].screenY},{x:n.touches[1].screenX,y:n.touches[1].screenY})});$(".ngdialog-content").bind("touchend",function(n){n.touches.length==1&&r({x:n.touches[0].screenX,y:n.touches[0].screenY});n.touches.length==0&&r()});$(".ngdialog-content").bind("mousedown",function(t){this.setCapture&&this.setCapture();ht=!0;n({x:t.screenX,y:t.screenY})});$(".ngdialog-content").bind("mousemove",function(n){ht&&(n.preventDefault(),i({x:n.screenX,y:n.screenY}))});$(".ngdialog-content").bind("mouseup",function(){this.releaseCapture&&this.releaseCapture();ht=!1;r()});$(".ngdialog-content").bind("mousewheel",function(n){l.css({"transition-property":"","transition-duration":""});var i=30;t=n.originalEvent.wheelDelta>0?a(t.width+i,"width",!1,!0):t.height-i<h||t.width-i<s?at<y/g?a(h,"height",!1,!0):a(s,"width",!1,!0):a(t.width-i,"width",!1,!0);nt(t)})};n.cut=function(){var n=document.getElementById("canvas");n.width=r;n.height=f;var o=n.getContext("2d"),i=t.width/y,a=s/i,v=h/i,p=(b+c-t.left)/i,w=(k+c-t.top)/i;o.drawImage(l[0],p,w,a,v,0,0,r,f);e(n.toDataURL("image/jpeg"));u.close()}}]})},showLoading:function(){return f=n.open({template:'<div class="sk-circle"><div class="sk-circle1 sk-child"><\/div><div class="sk-circle2 sk-child"><\/div><div class="sk-circle3 sk-child"><\/div><div class="sk-circle4 sk-child"><\/div><div class="sk-circle5 sk-child"><\/div><div class="sk-circle6 sk-child"><\/div><div class="sk-circle7 sk-child"><\/div><div class="sk-circle8 sk-child"><\/div><div class="sk-circle9 sk-child"><\/div><div class="sk-circle10 sk-child"><\/div><div class="sk-circle11 sk-child"><\/div><div class="sk-circle12 sk-child"><\/div><\/div>',className:"ngdialog-theme-loading",plain:!0,showClose:!1,closeByEscape:!1,closeByDocument:!1})}}}]);app.factory("storageService",["encodeService",function(n){return{getJWT:function(){return localStorage.jwt},setJWT:function(n){localStorage.jwt=n},removeJWT:function(){delete localStorage.jwt},getUserTypeId:function(){var i=localStorage.jwt.substr(0,localStorage.jwt.indexOf(".")),t=n.base64Decode(i);return t=JSON.parse(t),t.UserTypeId},getUserId:function(){var i=localStorage.jwt.substr(0,localStorage.jwt.indexOf(".")),t=n.base64Decode(i);return t=JSON.parse(t),t.UserId},getIsBeautician:function(){var i=localStorage.jwt.substr(0,localStorage.jwt.indexOf(".")),t=n.base64Decode(i);return t=JSON.parse(t),t.IsBeautician},getIdentityCode:function(){var i=localStorage.jwt.substr(0,localStorage.jwt.indexOf(".")),t=n.base64Decode(i);return t=JSON.parse(t),t.IdentityCode},getAuthSalons:function(){return localStorage.authSalons},setAuthSalons:function(n){localStorage.authSalons=n},removeAuthSalons:function(){delete localStorage.authSalons}}}]);app.factory("apiService",["$http","routeService","ngDialog","storageService","dialogService","$rootScope",function(n,t,i,r,u,f){function h(n){return n.status==500?t.goParams("error"):n.status==404?t.goParams("error",{msg:encodeURIComponent("您请求的数据不存在，请返回首页重新浏览")}):n.status==400?u.showMention(1,n.data[0]):n.status==401?t.goParams("login"):t.goParams("error"),!1}function o(n){this.promise=n;this.then=function(n,t){var i=this.promise.then(function(t){if(!t)return!1;e--;e==0&&s.close();var i=null;return n&&(i=n(t)),i instanceof o?i.promise:i},function(n){if(e=0,s.close(),t==null)h(n);else{var i=t(n);return i instanceof o?i.promise:i}});return new o(i)}}var e=0,s=null;return{call:function(t,i,h){var c,l,a;return e==0&&(s=u.showLoading()),e++,c=r.getJWT(),l={},c!=null&&(l.Authorization="JWT "+c),a=n({url:f.APIURL+i,method:t,data:h,headers:l}),new o(a)}}}])})();