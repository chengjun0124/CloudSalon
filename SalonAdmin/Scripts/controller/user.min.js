app.controller("user",["$scope","userAPIService","$stateParams","purchasedServiceAPIService","storageService",function(n,t,i,r,u){function e(){r.getPurchasedServices(f,n.userId).then(function(t){if(f==1&&(n.purchasedServices=[]),t.data.length>0)for(var i=0;i<t.data.length;i++)n.purchasedServices.push(t.data[i]);n.dataForLoadMore=n.purchasedServices.length==0?null:t.data})}n.title="用户详情";n.routeName="customers";n.userId=i.userId;n.user=null;var f=1;n.purchasedServices=null;n.purchasedServiceCount=null;n.dataForLoadMore=null;n.userTypeId=u.getUserTypeId();t.getUser(n.userId).then(function(t){n.user=t.data});e();n.getLastConsumedDate=function(n){return n.length>0?n[0].createdDate.format("YYYY-MM-dd"):""};n.getLastConsumedEmployeeNickName=function(n){return n.length>0?n[0].employeeNickName:""};n.getRemainTime=function(n){for(var i=n.time,t=0;t<n.consumedServices.length;t++)i-=n.consumedServices[t].time;return i};r.getPurchasedServiceCount(n.userId).then(function(t){n.purchasedServiceCount=t.data});n.loadMore=function(){f++;e()}}]);