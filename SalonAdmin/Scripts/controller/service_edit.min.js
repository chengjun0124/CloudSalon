app.controller("service_edit",["$scope","serviceAPIService","$stateParams","dialogService","$sce","tagAPIService",function(n,t,i,r,u,f){n.serviceId=i.serviceId;n.isCreate=i.serviceId==""?!0:!1;n.title=n.isCreate?"新增服务":"编辑服务";n.routeName="services";n.serviceTypes=null;n.serviceTypeTags=[];n.inputedTag="";n.pains=[{value:0,text:"无疼痛"},{value:1,text:'<img src="../imgs/star.png" class="shrink_17 va_baseline"/>'},{value:2,text:'<img src="../imgs/star.png" class="shrink_17 va_baseline"/><img src="../imgs/star.png" class="shrink_17 va_baseline"/>'},{value:3,text:'<img src="../imgs/star.png" class="shrink_17 va_baseline"/><img src="../imgs/star.png" class="shrink_17 va_baseline"/><img src="../imgs/star.png" class="shrink_17 va_baseline"/>'},{value:4,text:'<img src="../imgs/star.png" class="shrink_17 va_baseline"/><img src="../imgs/star.png" class="shrink_17 va_baseline"/><img src="../imgs/star.png" class="shrink_17 va_baseline"/><img src="../imgs/star.png" class="shrink_17 va_baseline"/>'},{value:5,text:'<img src="../imgs/star.png" class="shrink_17 va_baseline"/><img src="../imgs/star.png" class="shrink_17 va_baseline"/><img src="../imgs/star.png" class="shrink_17 va_baseline"/><img src="../imgs/star.png" class="shrink_17 va_baseline"/><img src="../imgs/star.png" class="shrink_17 va_baseline"/>'}];n.service={};n.service.effectImages=[];n.service.functionalityTags=[];t.getServiceTypes().then(function(t){n.serviceTypes=t.data});n.isCreate||t.getService(n.serviceId).then(function(t){var i,r;for(n.service=t.data,n.subjectImage=n.service.subjectImage,n.service.subjectImage=null,i=0;i<n.service.effectImages.length;i++)r=n.service.effectImages[i].image.lastIndexOf("/"),n.service.effectImages[i].image=n.service.effectImages[i].image.substr(r+1)});n.$watch("service.serviceTypeId",function(){n.service.serviceTypeId!=undefined&&f.getServiceTypeTags(n.service.serviceTypeId).then(function(t){n.serviceTypeTags=t.data})});n.deleteTag=function(t){n.service.functionalityTags.splice(t,1)};n.addTag=function(t){n.service.functionalityTags.indexOf(t)==-1&&(n.service.functionalityTags.length>=5?r.showMention(1,"服务功效最多放置5个标签"):n.service.functionalityTags.push(t))};n.inputTag=function(){var t=n.inputedTag.replace(/\s/g,"");t.length>0&&n.addTag(t);n.inputedTag=null};n.submit=function(){n.service.subjectImage!=null&&(n.service.subjectImage=n.service.subjectImage.replace(/data:[^,]+,/,""));n.isCreate?t.createService(n.service).then(function(){r.showMention(1,"服务创建成功","services")}):t.updateService(n.service).then(function(){r.showMention(1,"服务修改成功","services")})};n.receiveDataURL=function(t){n.service.subjectImage=t;n.subjectImage=t};n.receiveEffectImageDataURL=function(t){n.service.effectImages.push({image:t.replace(/data:[^,]+,/,""),smallImage:t})};n.deleteEffectImage=function(t){r.showMention(2,"确定删除此效果图？",null,null,function(){n.service.effectImages.splice(t,1)})}}]);