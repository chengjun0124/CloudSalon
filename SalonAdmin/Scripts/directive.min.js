app.directive("validateClick",["$rootScope","dialogService",function(n,t){return{scope:{validateClick:"&",panel:"@"},link:function(i,r){r.on("click",function(){var s,k,v,w,d,g;$(".invalid_msg").text("");var h,e=[],nt,r,c,u,o,l,f=":::",b,y,p,tt,a,it,ut,rt;for(h=i.panel!=null&&i.panel!=undefined?$("#"+i.panel+" [validation]"):$("[validation]"),s=0;s<h.length;s++)for(nt=$(h[s]).attr("validation").split("|||"),c=$(h[s]).attr("fieldName"),o=$(h[s]).attr("mentionId"),u=$(h[s]).val(),k=0;k<nt.length;k++){if(r=nt[k],r=="required")if(h[s].tagName.toLowerCase()=="select"){if(h[s].selectedIndex==0){e.push({message:"请选择"+c,mentionId:o});break}}else if(h[s].tagName.toLowerCase()=="input"){if(u.trim().length==0){e.push({message:"请输入"+c,mentionId:o});break}}else if(u=$(h[s]).attr("ng-model"),u=i.$parent.$eval(u),u==null){e.push({message:"请选择"+c,mentionId:o});break}if(u.length>0){if(r.indexOf("pattern"+f)==0&&(l=new RegExp(r.split(f)[1]),!l.test(u))){e.push({message:c+r.split(f)[2],mentionId:o});break}if(r.indexOf("minlengh"+f)==0&&(tt=parseInt(r.split(f)[1]),u.length<tt)){e.push({message:c+"必须大于"+tt+"个字符",mentionId:o});break}if(r.indexOf("number"+f)==0)if(b=r.split(f)[1],b=="0"){if(!/^-{0,1}\d+$/.test(u)){e.push({message:c+"必须是整数",mentionId:o});break}}else if(l=new RegExp("^\\d+(.\\d{1,"+b+"}){0,1}$"),!l.test(u)){e.push({message:c+"必须是数字，且最多包含"+b+"位小数",mentionId:o});break}if(r.indexOf("range"+f)==0&&(y=r.split(f)[1].split("-")[0],p=r.split(f)[1].split("-")[1],y=parseFloat(y),p=parseFloat(p),parseFloat(u)<y||parseFloat(u)>p)){e.push({message:c+"必须在"+y+"-"+p+"之间",mentionId:o});break}if(r.indexOf("mobile")==0&&(l=new RegExp(/\d{11}$/),!l.test(u))){e.push({message:"手机必须为11位纯数字",mentionId:o});break}}if(r.indexOf("compare"+f)==0&&(a=r.split(f)[1],a=isNaN(a)?$("#"+r.split(f)[1]).val():parseFloat(a),it=r.split(f)[2],ut=r.split(f)[3]=="true"?!0:!1,rt=r.split(f)[4],ut||u.length>0))if(it=="equal"){if(u!=a){e.push({message:c+"和"+rt+"必须相等",mentionId:o});break}}else if(it=="<="&&parseFloat(u)>a){e.push({message:c+"不能大于"+rt,mentionId:o});break}if(r.indexOf("oneisrequired"+f)==0){if(v=!1,v=$(h[s]).attr("type")=="checkbox"?h[s].checked:u.trim().length>0,!v)for(w=r.split(f),d=1;d<w.length-1;d++)if(g=$("#"+w[d]),g.attr("type")=="checkbox"){if(g[0].checked){v=!0;break}}else if(g.val().trim().length>0){v=!0;break}if(!v){e.push({message:c+"和"+w[w.length-1]+"至少填写一个",mentionId:o});break}}}e.length>0&&t.showMention(1,e[0].message);e.length==0&&(i.validateClick(),n.$apply())})}}}]);app.directive("selector",["$rootScope","ngDialog",function(n,t){return{restrict:"EA",scope:{items:"=",ngModel:"=",dialogClassName:"@",isMultiple:"=",itemValue:"@",itemText:"@",opener:"@"},link:function(i,r,u){function f(){var t,u,n;if(i.ngModel!=null&&i.items!=null)if(i.isMultiple){for(t="",n=0;n<i.items.length;n++)for(u=0;u<i.ngModel.length;u++)i.items[n][i.itemValue]==i.ngModel[u]&&(t+=i.items[n][i.itemText]+",");t=t.substring(0,t.length-1);r.html(t)}else for(n=0;n<i.items.length;n++)i.items[n][i.itemValue]==i.ngModel&&r.html(i.items[n][i.itemText])}i.$watch("ngModel",function(){f()});i.$watch("items",function(){f()});i.isMultiple=u.isMultiple=="true"?!0:!1;i.dialogClassName==undefined&&(i.dialogClassName="");f();var e=function(){var r=t.open({template:n.dialogSelectorTemplate,showClose:!1,closeByEscape:!1,overlay:!0,className:"ngdialog-theme-selector "+i.dialogClassName,closeByDocument:!0,controller:["$scope","$sce",function(n){var u,t;for(n.items=i.items,n.isMultiple=i.isMultiple,n.selectedIndexes=new Array(n.items.length),n.itemValue=i.itemValue,n.itemText=i.itemText,t=0;t<n.selectedIndexes.length;t++)n.selectedIndexes[t]=!1;if(i.isMultiple){for(t=0;t<i.items.length;t++)for(u=0;u<i.ngModel.length;u++)if(n.items[t][n.itemValue]==i.ngModel[u]){n.selectedIndexes[t]=!0;break}}else for(t=0;t<i.items.length;t++)if(n.items[t][n.itemValue]==i.ngModel){n.selectedIndexes[t]=!0;break}n.select=function(t){if(n.isMultiple){var u=n.items.indexOf(t);n.selectedIndexes[u]=!n.selectedIndexes[u]}else i.ngModel=t[n.itemValue],r.close()};n.confirm=function(){i.ngModel=[];for(var t=0;t<n.items.length;t++)n.selectedIndexes[t]&&i.ngModel.push(n.items[t][n.itemValue]);r.close()}}]})};if(i.opener==undefined)r.on("click",e);else $("#"+i.opener).on("click",e)}}}]);app.directive("datePickup",["$rootScope","ngDialog",function(n,t){return{restrict:"EA",scope:{minDate:"@",maxDate:"@",ngModel:"=",dateType:"@",placeholder:"@",opener:"@"},link:function(i,r){i.$watch("ngModel",function(){i.ngModel==null||i.ngModel==undefined||i.ngModel.length==0?r.html(i.placeholder):r.html(i.ngModel)});var u=function(){t.open({template:n.dialogDatepickupTemplate,showClose:!1,closeByEscape:!1,overlay:!0,className:"ngdialog-theme-datepickup",closeByDocument:!0,controller:["$scope",function(n){function a(t){var i=0,u=11;for(t==r.getFullYear()&&(i=r.getMonth()),t==f.getFullYear()&&(u=f.getMonth()),n.months.length=0;i<=u;)n.months.push(i),i++}function v(t){for(var i=0;i<n.months.length;i++)if(n.months[i]==t){n.monthOffset=i*2;return}n.monthOffset=t<n.months[0]?0:(n.months.length-1)*2}function y(t,i){var u=1,e;for(t==r.getFullYear()&&i==r.getMonth()&&(u=r.getDate()),e=t==f.getFullYear()&&i==f.getMonth()?f.getDate():w(t,i),n.dates.length=0;u<=e;)n.dates.push(u),u++}function p(t){for(var i=0;i<n.dates.length;i++)if(n.dates[i]==t){n.dateOffset=i*2;return}n.dateOffset=t<n.dates[0]?0:(n.dates.length-1)*2}function w(n,t){return t==1?n%4==0&&n%100!=0||n%400==0&&n%4e3!=0?29:28:t==3||t==5||t==8||t==10?30:31}var r=new Date(i.minDate),f=new Date(i.maxDate),t,u,e,o,s,h,c,l;for(n.dateType=i.dateType,n.years=[],n.months=[],n.dates=[],n.hours=[],n.minutes=[],t=i.ngModel==null||i.ngModel==undefined||i.ngModel.length==0?new Date:i.dateType=="date"||i.dateType=="datetime"?new Date(i.ngModel):new Date("0000-1-1 "+i.ngModel),u=0;u<=f.getFullYear()-r.getFullYear();u++)n.years.push(r.getFullYear()+u);for(n.yearOffset=(t.getFullYear()-r.getFullYear())*2,a(t.getFullYear()),v(t.getMonth()),y(t.getFullYear(),t.getMonth()),p(t.getDate()),n.hours=[],u=0;u<24;u++)n.hours.push(u);n.hourOffset=t.getHours()*2;n.minutes=[0,30];n.minuteOffset=t.getMinutes()==0?0:2;n.confirm=function(){var t="",r,u;if(i.dateType=="date"||i.dateType=="datetime"){var f=n.years[n.yearOffset/2],e=n.months[n.monthOffset/2],o=n.dates[n.dateOffset/2];t=f.toString()+"-"+(e+1).toString()+"-"+o.toString()}(i.dateType=="time"||i.dateType=="datetime")&&(r=n.hours[n.hourOffset/2],u=n.minutes[n.minuteOffset/2],t=t.length==0?r.toStringWithPrefix(2)+":"+u.toStringWithPrefix(2):" "+r.toStringWithPrefix(2)+":"+u.toStringWithPrefix(2));i.ngModel=t;n.closeThisDialog()};n.gearTouchStart=function(t){e=n.$event.targetTouches[0].screenY;t=="YYYY"?o=n.yearOffset:t=="MM"?s=n.monthOffset:t=="dd"?h=n.dateOffset:t=="hh"?c=n.hourOffset:t=="mm"&&(l=n.minuteOffset)};n.gearTouchMove=function(t){var r=n.$event.targetTouches[0].screenY-e,i,u;r=r*60/window.innerHeight;t=="YYYY"?(i=o-r,u=(n.years.length-1)*2):t=="MM"?(i=s-r,u=(n.months.length-1)*2):t=="dd"?(i=h-r,u=(n.dates.length-1)*2):t=="hh"?(i=c-r,u=(n.hours.length-1)*2):t=="mm"&&(i=l-r,u=(n.minutes.length-1)*2);i<0?i=0:i>u&&(i=u);t=="YYYY"?n.yearOffset=i:t=="MM"?n.monthOffset=i:t=="dd"?n.dateOffset=i:t=="hh"?n.hourOffset=i:t=="mm"&&(n.minuteOffset=i)};n.gearTouchEnd=function(t){var i,r,u;t=="YYYY"?i=n.yearOffset:t=="MM"?i=n.monthOffset:t=="dd"?i=n.dateOffset:t=="hh"?i=n.hourOffset:t=="mm"&&(i=n.minuteOffset);i%2>=1?(i=Math.floor(i/2)+1,i=i*2):(i=Math.floor(i/2),i=i*2);t=="YYYY"?n.yearOffset=i:t=="MM"?n.monthOffset=i:t=="dd"?n.dateOffset=i:t=="hh"?n.hourOffset=i:t=="mm"&&(n.minuteOffset=i);r=n.months[n.monthOffset/2];a(n.years[n.yearOffset/2]);v(r);u=n.dates[n.dateOffset/2];y(n.years[n.yearOffset/2],n.months[n.monthOffset/2]);p(u)}}]})};if(i.opener==undefined)r.on("click",u);else $("#"+i.opener).on("click",u)}}}]);app.directive("uploadImage",["dialogService",function(n){var t=$('<input type="file" style="display:none" />').appendTo("body");return{scope:{cutWidth:"=",cutHeight:"=",recieveImage:"="},link:function(i,r){r.bind("click",function(){t.unbind("change");t.on("change",function(){var r=new FileReader;r.onload=function(){var t=new Image;t.onload=function(){n.showUploadImage(t.src.replace(/data:[^,]+,/,"data:image/jpeg;base64,"),i.cutWidth,i.cutHeight,i.recieveImage)};t.onerror=function(){n.showMention(1,"请选择正确的图片")};t.src=r.result};r.readAsDataURL(t[0].files[0]);t.val("")});t.click()})}}}]);app.directive("ngTouchstart",[function(){return{controller:["$scope","$element",function(n,t){function i(i){var r=t.attr("ng-touchstart");n.$event=i;n.$apply(r)}t.bind("touchstart",i)}]}}]);app.directive("ngTouchmove",[function(){return{controller:["$scope","$element",function(n,t){function u(n){n.preventDefault();t.bind("touchmove",i);t.bind("touchend",r)}function i(i){var r=t.attr("ng-touchmove");n.$event=i;n.$apply(r)}function r(n){n.preventDefault();t.unbind("touchmove",i);t.unbind("touchend",r)}t.bind("touchstart",u)}]}}]);app.directive("ngTouchend",[function(){return{controller:["$scope","$element",function(n,t){function i(i){var r=t.attr("ng-touchend");n.$event=i;n.$apply(r)}t.bind("touchend",i)}]}}]);app.directive("ngLoad",[function(){return{scope:{ngLoad:"&"},link:function(n,t){t.bind("load",function(){n.$apply(function(){n.ngLoad()})})}}}]);app.directive("loadMore",[function(){return{scope:{loadMore:"&",pageSize:"=",data:"=",loadMoreCss:"@",top:"=",bottom:"="},link:function(n,t){var c,r=$('<div style="display:none;"><\/div>'),v,h;n.loadMoreCss==null||n.loadMoreCss==undefined||n.loadMoreCss.trim().length==0?r.addClass("content bgc_grey2 ta_c fc_grey"):r.addClass(n.loadMoreCss);t.after(r);var f=!1,o=!1,i=0,u=null,e,l=$(window).height()-(n.top==null?0:n.top)-(n.bottom==null?0:n.bottom);if(window.ontouchstart!==undefined){n.$on("$stateChangeStart",function(){$("body").css({height:"",overflow:""});$("html").css({height:"",overflow:""})});$("body").css({height:"100%",overflow:"hidden"});$("html").css({height:"100%",overflow:"hidden"});t.on("touchstart",function(n){e=l>t.outerHeight()+r.outerHeight()?0:l-(t.outerHeight()+r.outerHeight());c=n.targetTouches[0].screenY});t.on("touchmove",function(n){n.preventDefault();u=n.targetTouches[0].screenY-c;/android/gi.test(navigator.appVersion)&&(u*=2);i+u>0?u=0-i:i+u<e?f?u=e-i:(o=!0,r.text("释放加载更多")):(o=!1,f||r.text("上拉加载更多"));t.css({transform:"translate(0px, "+(i+u)+"px)"});r.css({transform:"translate(0px, "+(i+u)+"px)"})});t.on("touchend",function(){u!=null&&(i=i+u,i>0&&(i=0),i<e&&(i=e),t.css({transform:"translate(0px, "+i+"px)"}),r.css({transform:"translate(0px, "+i+"px)"}),o&&(r.text("加载中。。。"),n.loadMore(),o=!1),u=null)});n.$watch("data",function(){n.data==null?(f=!0,r.css({display:"none"})):n.data.length<n.pageSize?(f=!0,r.text("已加载全部"),r.css({display:""})):(f=!1,r.text("上拉加载更多"),r.css({display:""}))})}else{var s=$(window),y=$(document),a=function(){s.scrollTop()>=y.height()-s.outerHeight()&&(f||(r.text("加载中。。。"),n.loadMore()))};s.on("scroll",a);n.$on("$stateChangeStart",function(){s.unbind("scroll",a)});n.$watch("data",function(){n.data==null?(f=!0,r.css({display:"none"})):n.data.length<n.pageSize?(f=!0,r.text("已加载全部"),r.css({display:""})):(f=!1,r.text("下拉加载更多"),r.css({display:""}))})}v=!0;n.$on("resetPullPixel",function(){i=0;t.css({transform:"translate(0px, 0px)"})})}}}]);app.directive("enter",[function(){return{scope:{enter:"&",keys:"="},link:function(n,t){var i=[];n.keys==undefined?i.push(13):i=n.keys;t.keyup(function(t){i.indexOf(t.keyCode)!=-1&&n.$apply(function(){n.enter()})})}}}]);app.directive("htmlEditor",[function(){return{scope:{ngModel:"=",htmlEditor:"="},link:function(n,t){if(n.htmlEditor==!0){t[0].contentWindow.document.designMode="on";$(t[0].contentWindow.document.body).on("keyup",function(){t.css({height:$(t[0].contentWindow.document).outerHeight()+"px"});n.$apply(function(){n.ngModel=t[0].contentWindow.document.body.innerHTML})})}$(t[0].contentWindow.document.body).css({overflow:"hidden"});t[0].contentWindow.document.head.innerHTML="<style>img{max-width:100%}<\/style>";var i=n.$watch("ngModel",function(){n.ngModel!=undefined&&(t[0].contentWindow.document.body.innerHTML=n.ngModel,setTimeout(function(){t.css({height:$(t[0].contentWindow.document).outerHeight()+"px"})},1e3),i())})}}}]);app.directive("needPlaceholder",[function(){return{link:function(n,t){setTimeout(function(){var n=$("<div><\/div>");n.css({width:t.outerWidth()+"px",height:t.outerHeight()+"px"});t.after(n)},100)}}}]);app.directive("slideSwitch",[function(){return{scope:{ngModel:"="},template:"<span class=\"switch\" ng-class=\"{'enabled':ngModel,'disabled':!ngModel}\"><span><\/span><\/span>",replace:!0,link:function(n,t){t.on("click",function(){n.$apply(function(){n.ngModel=!n.ngModel})})}}}]);app.directive("noData",[function(){return{scope:{data:"="},template:'<div class="content ta_c bgc_grey2" ng-if="data.length==0"><img class="shrink_283" src="imgs/none_data.png" /><\/div>',replace:!0}}]);