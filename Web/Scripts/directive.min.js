app.directive("loadMore",[function(){return{scope:{loadMore:"&",pageSize:"=",data:"=",loadMoreCss:"@",top:"=",bottom:"="},link:function(n,t){var h,f=$('<div class="'+n.loadMoreCss+'"><\/div>'),l,s;t.append(f);var e=!1,o=!1,i=0,r=null,u,c=$(window).height()-(n.top==null?0:n.top)-(n.bottom==null?0:n.bottom);n.$on("$stateChangeStart",function(){$("body").css({height:"",overflow:""});$("html").css({height:"",overflow:""})});$("body").css({height:"100%",overflow:"hidden"});$("html").css({height:"100%",overflow:"hidden"});t.on("touchstart",function(n){u=c>t.outerHeight()?0:c-t.outerHeight();h=n.targetTouches[0].screenY});t.on("touchmove",function(n){n.preventDefault();r=n.targetTouches[0].screenY-h;/android/gi.test(navigator.appVersion)&&(r*=2);i+r>0?r=0-i:i+r<u?e?r=u-i:(o=!0,f.text("释放加载更多")):(o=!1,e||f.text("上拉加载更多"));t.css({transform:"translate(0px, "+(i+r)+"px)"})});t.on("touchend",function(){r!=null&&(i=i+r,i>0&&(i=0),i<u&&(i=u),t.css({transform:"translate(0px, "+i+"px)"}),o&&(f.text("加载中。。。"),n.loadMore(),o=!1),r=null)});l=!0;n.$watch("data",function(){n.data==null?(e=!0,f.text("")):n.data.length<n.pageSize?(e=!0,f.text("已加载全部")):(e=!1,f.text("上拉加载更多"))});n.$on("resetPullPixel",function(){i=0;t.css({transform:"translate(0px, 0px)"})})}}}]);app.directive("enter",[function(){return{scope:{enter:"&"},link:function(n,t){t.keyup(function(t){t.keyCode==13&&n.enter()})}}}]);app.directive("uploadImage",["dialogService",function(n){var t=$('<input type="file" style="display:none" />').appendTo("body"),i;return{scope:{cutWidth:"=",cutHeight:"=",recieveImage:"="},link:function(r,u){u.bind("click",function(){t.unbind("change");t.on("change",function(){i=n.showLoading();var u=new FileReader;u.onload=function(){var t=new Image;t.onload=function(){i.close();n.showUploadImage(t.src.replace(/data:[^,]+,/,"data:image/jpeg;base64,"),r.cutWidth,r.cutHeight,r.recieveImage)};t.onerror=function(){i.close();n.showMention(1,"请选择正确的图片")};t.src=u.result};u.readAsDataURL(t[0].files[0]);t.val("")});t.click()})}}}]);app.directive("ngLoad",[function(){return{scope:{ngLoad:"&"},link:function(n,t){t.bind("load",function(){n.$apply(function(){n.ngLoad()})})}}}]);app.directive("htmlEditor",[function(){return{scope:{ngModel:"=",htmlEditor:"="},link:function(n,t){if(n.htmlEditor==!0){t[0].contentWindow.document.designMode="on";$(t[0].contentWindow.document.body).on("keyup",function(){t.css({height:$(t[0].contentWindow.document).outerHeight()+"px"});n.$apply(function(){n.ngModel=t[0].contentWindow.document.body.innerHTML})})}$(t[0].contentWindow.document.body).css({overflow:"hidden"});t[0].contentWindow.document.head.innerHTML="<style>img{max-width:100%}<\/style>";var i=n.$watch("ngModel",function(){n.ngModel!=undefined&&(t[0].contentWindow.document.body.innerHTML=n.ngModel,setTimeout(function(){t.css({height:$(t[0].contentWindow.document).outerHeight()+"px"})},1e3),i())})}}}]);