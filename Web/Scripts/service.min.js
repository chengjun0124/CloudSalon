(function(){app.factory("locationEx",["$location",function(n){return n.queryString=function(t){var i=n.absUrl().match(new RegExp("[?&]"+t+"=([^#&]*)"));return i==null?null:i[1]},n}]);app.factory("routeService",["$state",function(n){return{goParams:function(t,i){$("html, body").scrollTop(0);n.go(t,i,{reload:!0})}}}]);app.factory("dialogService",["ngDialog","$rootScope","routeService",function(n,t,i){var u,r,f,e;return{showMention:function(u,f,e,o,s){r=n.open({template:t.dialogMentionTemplate,plain:!1,showClose:!1,closeByEscape:!1,overlay:!0,className:"ngdialog-theme-mention",closeByDocument:!1,controller:["$scope",function(n){n.$on("browserBack",function(n){n.callBack=function(){r.close()}});n.close=function(){r.close();e&&i.goParams(e,o)};n.confirm=function(){r.close();s();e&&i.goParams(e,o)}}],data:{buttonCount:u,content:f}})},showUploadImage:function(i,r,f,e){u=n.open({template:t.dialogUploadImageTemplate,plain:!1,showClose:!1,closeByEscape:!1,overlay:!1,className:"ngdialog-theme-upload-image",closeByDocument:!1,data:{base64Image:i},controller:["$scope",function(n){function at(){var n=c/l;n<p/d?(v=l,a=p*(v/d)):(a=c,v=d*(a/p));s=(k-v)/2;o=(b-a)/2;vt=o;yt=s;y.css({position:"fixed",width:a+"px",height:v+"px",top:s+"px",left:o+"px"})}var lt;n.$on("browserBack",function(n){n.callBack=function(){u.close()};n.preventDefault()});var w={x:null,y:null},t={x:null,y:null,w:null,h:null},o,s,v,a,y,b=$(window).width(),k=$(window).height(),p,d,vt,yt,tt,it,rt,ut,ft,et,ot,st,c=r,l=f,ht=500,ct=600;c<ht&&l<ct&&(lt=ht/ct,lt<c/l?(c=ht,l=f*(c/r)):(l=ct,c=r*(l/f)));var h=1e3,g=(b-c-h*2)/2,nt=(k-l-h*2)/2;n.base64Image=i;n.divCutCSS={width:c+h*2+"px",height:l+h*2+"px","border-width":h+"px",left:g+"px",top:nt+"px"};n.cancel=function(){u.close()};n.imgLoaded=function(){y=$("#oimg");p=y.width();d=y.height();at();$(".ngdialog-content").bind("touchstart",function(n){n.touches.length==1&&(w.x=n.touches[0].screenX,w.y=n.touches[0].screenY,t.x=0,t.y=0);n.touches.length==2&&(o+=t.x,s+=t.y,n.touches[0].screenX<n.touches[1].screenX?(tt=0,ft=n.touches[0].screenX,it=1,et=n.touches[1].screenX):(tt=1,ft=n.touches[1].screenX,it=0,et=n.touches[0].screenX),n.touches[0].screenY<n.touches[1].screenY?(rt=0,ot=n.touches[0].screenY,ut=1,st=n.touches[1].screenY):(rt=1,ot=n.touches[1].screenY,ut=0,st=n.touches[0].screenY),t.x=0,t.y=0,t.w=0,t.h=0)});$(".ngdialog-content").bind("touchmove",function(n){n.preventDefault();n.touches.length==1&&(t.x=n.touches[0].screenX-w.x,t.y=n.touches[0].screenY-w.y,y.css({left:o+t.x+"px",top:s+t.y+"px"}));n.touches.length==2&&(t.w=ft-n.touches[tt].screenX,t.w+=n.touches[it].screenX-et,t.h=d*t.w/p,t.h+=ot-n.touches[rt].screenY,t.h+=n.touches[ut].screenY-st,t.w=p*t.h/d,t.x=-(t.w/2),t.y=-(t.h/2),y.css({width:a+t.w+"px",left:o+t.x+"px",height:v+t.h+"px",top:s+t.y+"px"}))});$(".ngdialog-content").bind("touchend",function(n){n.touches.length==1&&(w.x=n.touches[0].screenX,w.y=n.touches[0].screenY,a=a+t.w,v=v+t.h,o=o+t.x,s=s+t.y,t.x=0,t.y=0,t.w=0,t.h=0);n.touches.length==0&&(o+=t.x,s+=t.y,t.x=0,t.y=0,a<c||v<l?at():(o>g+h&&(o=g+h),s>nt+h&&(s=nt+h),b-o-a>b-c-h-g&&(o=b-a-(b-c-h-g)),k-s-v>k-l-h-nt&&(s=k-v-(k-l-h-nt)),y.css({top:s+"px",left:o+"px"})))})};n.cut=function(){var n=document.getElementById("canvas");n.width=r;n.height=f;var i=n.getContext("2d"),t=a/p,v=c/t,w=l/t,b=(g+h-o)/t,k=(nt+h-s)/t;i.drawImage(y[0],b,k,v,w,0,0,r,f);e(n.toDataURL("image/jpeg"));u.close()}}]})},showLoading:function(){return e=n.open({template:'<div class="sk-circle"><div class="sk-circle1 sk-child"><\/div><div class="sk-circle2 sk-child"><\/div><div class="sk-circle3 sk-child"><\/div><div class="sk-circle4 sk-child"><\/div><div class="sk-circle5 sk-child"><\/div><div class="sk-circle6 sk-child"><\/div><div class="sk-circle7 sk-child"><\/div><div class="sk-circle8 sk-child"><\/div><div class="sk-circle9 sk-child"><\/div><div class="sk-circle10 sk-child"><\/div><div class="sk-circle11 sk-child"><\/div><div class="sk-circle12 sk-child"><\/div><\/div>',className:"ngdialog-theme-loading",plain:!0,showClose:!1,closeByEscape:!1,closeByDocument:!1,controller:["$scope",function(n){n.$on("browserBack",function(n){n.callBack=function(){e.close()}})}]})},showServiceTypes:function(i,u,e){f=r=n.open({template:t.dialogServiceTypesTemplate,plain:!1,showClose:!1,closeByEscape:!1,overlay:!0,className:"ngdialog-theme-service-types",closeByDocument:!0,controller:["$scope",function(n){n.$on("browserBack",function(n){n.callBack=function(){f.close()}});n.serviceTypes=n.ngDialogData.serviceTypes;n.selectedType=n.ngDialogData.selectedType;n.excludeAll=function(n){return n.serviceTypeId!=null};n.selectType=function(n){f.close();e(n)}}],data:{serviceTypes:i,selectedType:u}})}}}]);app.factory("storageService",[function(){return{set:function(n,t){localStorage[n]=t},get:function(n){return localStorage[n]},setSession:function(n,t){sessionStorage[n]=t},getSession:function(n){return sessionStorage[n]}}}]);app.factory("apiService",["$http","routeService","ngDialog","storageService","locationEx","dialogService","$state","$rootScope",function(n,t,i,r,u,f,e,o){function l(n){return n.status==500?t.goParams("error"):n.status==404?t.goParams("error",{msg:encodeURIComponent("您请求的数据不存在，请返回首页重新浏览")}):n.status==400?f.showMention(1,n.data[0]):n.status==401?t.goParams("login",{redirect:encodeURIComponent('{ "state": "'+e.current.name+'", "params": '+JSON.stringify(e.params)+"}")}):t.goParams("error"),!1}function h(n){this.promise=n;this.then=function(n,t){var i=this.promise.then(function(t){if(!t)return!1;s--;s==0&&c.close();var i=null;return n&&(i=n(t)),i instanceof h?i.promise:i},function(n){if(s=0,c.close(),t==null)l(n);else{var i=t(n);return i instanceof h?i.promise:i}});return new h(i)}}var s=0,c=null;return{call:function(t,i,e){var v;s==0&&(c=f.showLoading());s++;var y=u.queryString("identitycode"),l=r.get(y),a={};return l!=null&&(a.Authorization="JWT "+l),v=n({url:o.APIURL+i,method:t,data:e,headers:a}),new h(v)}}}])})();